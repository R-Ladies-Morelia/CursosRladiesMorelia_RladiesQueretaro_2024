{
  "hash": "6e872f44e2401dc143ad653464173feb",
  "result": {
    "markdown": "---\ntitle: \"Importar y exportar datos\"\n---\n\n\n## Crear un objeto data.table\n\nUn objeto data.table se puede definir, por ejemplo:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(data.table)\n\nDT = data.table(\n  ID = c(\"b\",\"b\",\"b\",\"a\",\"a\",\"c\"),\n  a = 1:6,\n  b = 7:12,\n  c = 13:18\n)\n\nDT\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       ID     a     b     c\n   <char> <int> <int> <int>\n1:      b     1     7    13\n2:      b     2     8    14\n3:      b     3     9    15\n4:      a     4    10    16\n5:      a     5    11    17\n6:      c     6    12    18\n```\n:::\n:::\n\n\n<br>\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio\n\nImaginemos que queremos crear una simulación de una base de datos de secuencias aleatorias. La tabla que queremos al final va a tener dos columnas, la primera es un número identificador de cada secuencia y la segunda la secuencia aleatoria de tamaño 300. Por ejemplo, la siguiente tabla muestra las primeras 10 filas del resultado esperado. \n\n\n::: {.cell}\n::: {.cell-output-display}\n| id|sequencia                                                                                            |\n|--:|:----------------------------------------------------------------------------------------------------|\n|  1|CAGCGATCTGATCACCTTGAACCGAGAAACTATTTTGCTCAAGGAGGGTGGCTGATCTATCCCTTATCTGTGACACTGTCGGACGCGAAGGTAGCTGTTG |\n|  2|GCGACTCCGTCAAAGGGACCACTAGACTGTTGCTTTTGACGTGCGCTGCAAAAGTCACAACCTTAGGGATAACATAGTTATACTTGCATCAGACAGAAGA |\n|  3|TCAAACGTCTTGGTTGAAGACAGTCCAAGAGGCGCGTGTAGTGAGGGGTAACTGAGCCGTTTCCCCATAAAAGGACCAATATGGTCACAATTATGCCCCT |\n|  4|CAGACCGATCCGGAAGCCTGCATCAAACGCACAAGGGCACCTCCCATACACTATTATTAGGATCGCGACTAACCTTTTCACCGCGGTTGAGGACTGCTGA |\n|  5|TTTACCCGGGCATTATCACAGCCTCCGTTAAATACAGAACCACGATATAAGTACGAAAATGAATATTTTCGCTCTTCCTTAAGTTGCAACAACTAGGGCG |\n|  6|CTAAGGCCTGCAACTAGCCCACGTCGTGGATGAAATACACGGAATGTTGTTTTCCACCGGAGCTAGGAATCGCTAGCGCTTACCCGTTGAACAAATAAAA |\n:::\n:::\n\n\n**Ejercicio:** Genera un objeto data.table en el que la primera columna sea un id de secuencia y la segunda sea una secuencia (aleatoria) de tamaño 300 caracteres\n\n:::\n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsecuencias <- data.table(\n                id = seq(1,10000), \n                sequencia = sapply(seq(1, 10000), function(x) paste(sample(c(\"A\", \"T\", \"C\", \"G\"), 100, replace = TRUE), collapse = \"\")))\n\nhead(secuencias)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      id                                                                                            sequencia\n   <int>                                                                                               <char>\n1:     1 AAACAAGGTTGCTAAATACGGGCTTCGGCGCTACTCGAGGATGATTTAGCTTTGCCCCGTCGTGTTGCCGAAACTAATATGGGTGGGTATGAAATCGTAT\n2:     2 ATGAGGGTTGAGCTCAACTGCAAATCCGTTGTTGATGATCTTACGATACAGAGTCCGGTATAAGGTTCTCGCCTAATGGAATCTGTAAAAACGCAATTCG\n3:     3 TTAGCCATAATTATAGACTTTCAAGTGAAAAGAAACTCTTTACTCAACCTGGTGGAGTTTCATCATTTAAGATCGCCTGCTTGAGTTCAAAGTTCACTTG\n4:     4 AGCGGTGCGGTAAGGTTTCAAAAGATTCACGCGGAGACGATCCGCCACCATTTGCCTACCATCGATAATCGGCGGTTCCCCGCGCGTCGGACTGGATATA\n5:     5 TCACGACCCTACCGGGGCTTCATAAACACAGGATGGGACAAGCATCTACGATAAGTGAGCGAGTTCTCTTCTGGATGCGGCAGCGATACACTGTTGAAAT\n6:     6 TGCAATGAGAACGGACCGTTATTTGATCGCTTTTTATATCAACTAAAGAAACCGAGTTCTGAGCGGGGAGAAGCTACGTGACTACAATGAAGACTTCCGG\n```\n:::\n:::\n\n:::\n\n\n<br>\n\n## Importar y exportar datos de archivos\n\nLas funciones para importar (`fread`) y exportar (`fwrite`) tienen las siguientes opciones principales:\n\n- `x`: el objeto que queremos exportar.\n\n- `file`: ruta para escribir/leer el archivo.\n\n- `sep`: el delimitador entre columnas.\n\n- `dec`: el separador decimal.\n\n- `dateTimeAs`: formato en el que guardar objetos de fecha. Por defecto es “ISO”.\n\n### Conjunto de datos\n\nEn esta y la siguiente sección vamos a trabajar una tabla de todos los especímenes de plantas que tiene registrados la plataforma GBIF (Global Biodiversity Information Facility) para México. Específicamente esta tabla solo contiene los registros de plantas que tienen un especímen guardado en alguna colección biológica y que tienen coordenadas que nos permitan ubicarlos.\n\n\n**Ejemplo**: Por ejemplo, podemos importar la tabla de plantae_mexico_conCoords_specimen.csv que tiene 3062756 registros y 50 filas. \n\n**Nota:** `fread()` también permite leer archivos comprimidos `.gz`\n\n```{.r}\nlibrary(data.table)\n\ndata = fread(\"data/plantae_mexico_conCoords_specimen.csv\", quote=\"\")\n\nhead(data) |> knitr::kable()\n```\n\n\n::: {.cell}\n::: {.cell-output-display}\n|     gbifID|occurrenceID                 |phylum       |class          |order        |family        |genus         |species                |infraspecificEpithet |taxonRank |scientificName                                           |verbatimScientificName                                                               |verbatimScientificNameAuthorship |countryCode |stateProvince     | decimalLatitude| decimalLongitude|coordinateUncertaintyInMeters | elevation| day| month| year|basisOfRecord      |\n|----------:|:----------------------------|:------------|:--------------|:------------|:-------------|:-------------|:----------------------|:--------------------|:---------|:--------------------------------------------------------|:------------------------------------------------------------------------------------|:--------------------------------|:-----------|:-----------------|---------------:|----------------:|:-----------------------------|---------:|---:|-----:|----:|:------------------|\n| 2825623524|TAIF:PLANT:318128:1:1:411555 |Tracheophyta |Polypodiopsida |Polypodiales |Pteridaceae   |Adiantum      |Adiantum andicola      |                     |SPECIES   |Adiantum andicola Liebm.                                 |Adiantum andicola Liebm.                                                             |NA                               |MX          |Oaxaca (瓦哈卡州) |        17.30213|        -96.38080|NA                            |      2267|  27|     2| 2012|PRESERVED_SPECIMEN |\n| 2825649445|TAIF:PLANT:318579:1:1:411579 |Tracheophyta |Polypodiopsida |Polypodiales |Pteridaceae   |Scoliosorus   |Scoliosorus ensiformis |                     |SPECIES   |Scoliosorus ensiformis (Hook.) T.Moore                   |Scoliosorus ensiformis (Hook.) T. Moore                                              |NA                               |MX          |Oaxaca (瓦哈卡州) |        17.30213|        -96.38080|NA                            |      2267|  27|     2| 2012|PRESERVED_SPECIMEN |\n| 2825649446|TAIF:PLANT:318694:1:1:411603 |Tracheophyta |Polypodiopsida |Polypodiales |Polypodiaceae |Pleopeltis    |Pleopeltis polylepis   |interjecta           |VARIETY   |Pleopeltis polylepis var. interjecta (Weath.) E.A.Hooper |Pleopeltis polylepis (Roem. ex Kunze) T. Moore var. interjecta (Weath.) E. A. Hooper |NA                               |MX          |Oaxaca (瓦哈卡州) |        17.38178|        -96.44162|NA                            |      2959|  29|     2| 2012|PRESERVED_SPECIMEN |\n| 2825649447|TAIF:PLANT:318705:1:1:411602 |Tracheophyta |Polypodiopsida |Polypodiales |Aspleniaceae  |Asplenium     |Asplenium monanthes    |                     |SPECIES   |Asplenium monanthes L.                                   |Asplenium monanthes L.                                                               |NA                               |MX          |Oaxaca (瓦哈卡州) |        17.36213|        -96.44678|NA                            |      2820|  29|     2| 2012|PRESERVED_SPECIMEN |\n| 2825649448|TAIF:PLANT:318740:1:1:411609 |Tracheophyta |Lycopodiopsida |Lycopodiales |Lycopodiaceae |Diphasiastrum |Diphasiastrum thyoides |                     |SPECIES   |Diphasiastrum thyoides (Humb. & Bonpl. ex Willd.) Holub  |Diphasiastrum thyoides (Humb. & Bonpl. ex Willd.) Holub                              |NA                               |MX          |Oaxaca (瓦哈卡州) |        17.30213|        -96.38080|NA                            |      2267|  27|     2| 2012|PRESERVED_SPECIMEN |\n| 2825649449|TAIF:PLANT:318741:1:1:411583 |Tracheophyta |Polypodiopsida |Equisetales  |Equisetaceae  |Equisetum     |Equisetum praealtum    |affine               |VARIETY   |Equisetum hyemale var. affine (Engelm.) A.A.Eaton        |Equisetum hyemale L. var. affine (Engelm.) A. A. Eaton                               |NA                               |MX          |Oaxaca (瓦哈卡州) |        17.35835|        -96.44460|NA                            |      2000|   1|     3| 2012|PRESERVED_SPECIMEN |\n:::\n:::\n\n\n<br>\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio\n\n\nUtiliza el código anterior para cargar la tabla de especímenes en tu computadora. \n\nNota: La tabla tiene más de 3 millones de registros y, en las pruebas que hicimos, observamos que la tabla ocupa 1.72 GB de memoria cuando se carga. Incluimos un subconjunto aleatorio de 100,000 filas (sub_100000_plantae_mexico_conCoords_specimen.csv) para los que quieran practicar con objetos que ocupen menos memoria. \n\n:::\n\n## Exportar\n\ndata.table también tiene una función optimizada para escribir los datos con los que estamos trabajando en forma de archivo. Los argumentos básicos son:\n\n- `x` = objeto que se quiere exportar como archivo\n- `file` = nombre del archivo\n- `sep` = caracter que se quiere utilizar como delimitador de campo\n- `compress` = debido a que podríamos estar trabajando con tablas de datos muy grandes podemos escribir los archivos comprimidos. Se puede especificar \"gzip\" o \"auto\" y utilizar la extension `.gz` en el nombre del archivo para escribir un archivo comprimido, la opción \"none\" nos permite escribir archivos sin comprimir. \n\n**Ejemplo**: podemos escribir la tabla DT que creamos al principio de la sección:\n\n```{.r}\nfwrite(data, \"data/testDT.csv\", sep = \",\")\n```\n\n<br>\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio\n\n\nExporta la tabla de registros de especimenes como un archivo comprimido.\n\n:::\n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n\n```{.r}\nfwrite(data, \"data/plantae_mexico_conCoords_specimen.csv.gz\", sep = \",\", compress = \"auto\")\n```\n\n:::\n\n## Velocidad dplyr vs data.table\n\n```{.r}\n\nlibrary(rbenchmark)\n\ntest = benchmark(\"r base\" = {\n            read.csv(\"big_data/plantae_mexico_conCoords_specimen.csv\")\n          },\n          \"data.table\" = {\n            fread(\"big_data/plantae_mexico_conCoords_specimen.csv\")\n          },\n          replications = 10,\n          columns = c(\"test\", \"replications\", \"elapsed\",\n                      \"relative\", \"user.self\", \"sys.self\"))\n\n```\n**Nota:** Si quieres correr este código revisa cuántas réplicas quieres hacer porque está escrito para leer la tabla de registros grande 10 veces utilizando cada método. \n\n\n::: {.cell}\n::: {.cell-output-display}\n|  X|test       | replications| elapsed| relative| user.self| sys.self|\n|--:|:----------|------------:|-------:|--------:|---------:|--------:|\n|  2|data.table |           10| 110.933|    1.000|   206.818|    3.027|\n|  1|r base     |           10| 380.665|    3.431|   376.605|    4.057|\n:::\n:::\n\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio opcional\n\nSi quieres, puedes revisar el tiempo que te toma cargar la base de datos XX utilizando read.csv y fread. Utiliza el comando de benchmark de la paquetería rbenchmark para contar el tiempo. Nota: en el número de réplicas puedes poner una o dos porque si no te vas a tardar mucho. \n\n:::\n\n<br>\n\n## data.frame - data.table\n\nEl objeto de data.table es un objeto basado en un data.frame, por lo tanto es compatible con las funciones de R base que trabajan con data.frame. \n\n```{.r}\nstr(data)\n```\n```\nClasses ‘data.table’ and 'data.frame':  3062756 obs. of  23 variables:\n $ gbifID                          :integer64 2825623524 2825649445 2825649446 2825649447 2825649448 2825649449 2825649452 2825649453 ... \n $ occurrenceID                    : chr  \"TAIF:PLANT:318128:1:1:411555\" \"TAIF:PLANT:318579:1:1:411579\" \"TAIF:PLANT:318694:1:1:411603\" \"TAIF:PLANT:318705:1:1:411602\" ...\n $ phylum                          : chr  \"Tracheophyta\" \"Tracheophyta\" \"Tracheophyta\" \"Tracheophyta\" ...\n $ class                           : chr  \"Polypodiopsida\" \"Polypodiopsida\" \"Polypodiopsida\" \"Polypodiopsida\" ...\n $ order                           : chr  \"Polypodiales\" \"Polypodiales\" \"Polypodiales\" \"Polypodiales\" ...\n $ family                          : chr  \"Pteridaceae\" \"Pteridaceae\" \"Polypodiaceae\" \"Aspleniaceae\" ...\n $ genus                           : chr  \"Adiantum\" \"Scoliosorus\" \"Pleopeltis\" \"Asplenium\" ...\n $ species                         : chr  \"Adiantum andicola\" \"Scoliosorus ensiformis\" \"Pleopeltis polylepis\" \"Asplenium monanthes\" ...\n $ infraspecificEpithet            : chr  \"\" \"\" \"interjecta\" \"\" ...\n $ taxonRank                       : chr  \"SPECIES\" \"SPECIES\" \"VARIETY\" \"SPECIES\" ...\n $ scientificName                  : chr  \"Adiantum andicola Liebm.\" \"Scoliosorus ensiformis (Hook.) T.Moore\" \"Pleopeltis polylepis var. interjecta (Weath.) E.A.Hooper\" \"Asplenium monanthes L.\" ...\n $ verbatimScientificName          : chr  \"Adiantum andicola Liebm.\" \"Scoliosorus ensiformis (Hook.) T. Moore\" \"Pleopeltis polylepis (Roem. ex Kunze) T. Moore var. interjecta (Weath.) E. A. Hooper\" \"Asplenium monanthes L.\" ...\n $ verbatimScientificNameAuthorship: chr  \"\" \"\" \"\" \"\" ...\n $ countryCode                     : chr  \"MX\" \"MX\" \"MX\" \"MX\" ...\n $ stateProvince                   : chr  \"Oaxaca (瓦哈卡州)\" \"Oaxaca (瓦哈卡州)\" \"Oaxaca (瓦哈卡州)\" \"Oaxaca (瓦哈卡州)\" ...\n $ decimalLatitude                 : num  17.3 17.3 17.4 17.4 17.3 ...\n $ decimalLongitude                : num  -96.4 -96.4 -96.4 -96.4 -96.4 ...\n $ coordinateUncertaintyInMeters   : num  NA NA NA NA NA NA NA NA NA NA ...\n $ elevation                       : num  2267 2267 2959 2820 2267 ...\n $ day                             : int  27 27 29 29 27 1 27 27 5 1 ...\n $ month                           : int  2 2 2 2 2 3 2 2 5 3 ...\n $ year                            : int  2012 2012 2012 2012 2012 2012 2012 2012 2000 2012 ...\n $ basisOfRecord                   : chr  \"PRESERVED_SPECIMEN\" \"PRESERVED_SPECIMEN\" \"PRESERVED_SPECIMEN\" \"PRESERVED_SPECIMEN\" ...\n - attr(*, \".internal.selfref\")=<externalptr> \n - attr(*, \"index\")= int(0) \n  ..- attr(*, \"__genus\")= int [1:3062756] 419 423 490 494 513 514 521 542 571 585 ...\n\n```\n\nSin embargo, los objetos se pueden cambiar de clase. Por ejemplo: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(magrittr)\n\nas.data.frame(DT) %>% class()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"data.frame\"\n```\n:::\n\n```{.r .cell-code}\nas.data.frame(DT) %>% as.data.table() %>% class()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"data.table\" \"data.frame\"\n```\n:::\n:::\n",
    "supporting": [
      "tema2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}