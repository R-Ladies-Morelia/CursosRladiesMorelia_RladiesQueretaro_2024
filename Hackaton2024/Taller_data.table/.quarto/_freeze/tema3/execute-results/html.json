{
  "hash": "25f653295d0b69e5adaa61745bc9d99c",
  "result": {
    "markdown": "---\ntitle: \"Filtros y selección de columnas\"\nformat: \n  html:\n    page-layout: full \n---\n\n::: {.cell}\n\n:::\n\n\n# Operaciones sobre las filas\n\n## Seleccionar por índices\n\nSimilar a como se seleccionan filas en un data.frame, en un objeto data.table se pueden seleccionar filas utilizando rangos de índices. En los siguientes dos ejemplos se muestra como seleccionar las primeras dos filas de la tabla de registros. \n\n\n\n::: {.cell}\n\n:::\n\n\n```{.r}\nlibrary(data.table)\n\n\ndata = fread(\"data/plantae_mexico_conCoords_specimen.csv\")\n```\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata[1:2] \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       gbifID                 occurrenceID       phylum          class        order      family       genus\n        <i64>                       <char>       <char>         <char>       <char>      <char>      <char>\n1: 2825623524 TAIF:PLANT:318128:1:1:411555 Tracheophyta Polypodiopsida Polypodiales Pteridaceae    Adiantum\n2: 2825649445 TAIF:PLANT:318579:1:1:411579 Tracheophyta Polypodiopsida Polypodiales Pteridaceae Scoliosorus\n                  species infraspecificEpithet taxonRank                         scientificName\n                   <char>               <char>    <char>                                 <char>\n1:      Adiantum andicola                        SPECIES               Adiantum andicola Liebm.\n2: Scoliosorus ensiformis                        SPECIES Scoliosorus ensiformis (Hook.) T.Moore\n                    verbatimScientificName verbatimScientificNameAuthorship countryCode     stateProvince\n                                    <char>                           <lgcl>      <char>            <char>\n1:                Adiantum andicola Liebm.                               NA          MX Oaxaca (瓦哈卡州)\n2: Scoliosorus ensiformis (Hook.) T. Moore                               NA          MX Oaxaca (瓦哈卡州)\n   decimalLatitude decimalLongitude coordinateUncertaintyInMeters elevation   day month  year      basisOfRecord\n             <num>            <num>                        <lgcl>     <int> <int> <int> <int>             <char>\n1:        17.30213         -96.3808                            NA      2267    27     2  2012 PRESERVED_SPECIMEN\n2:        17.30213         -96.3808                            NA      2267    27     2  2012 PRESERVED_SPECIMEN\n```\n:::\n:::\n\n\n<br>\n\n**Nota:** Cuando solo estamos seleccionando filas no es necesario incluir la coma al final.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata[1:2,] \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       gbifID                 occurrenceID       phylum          class        order      family       genus\n        <i64>                       <char>       <char>         <char>       <char>      <char>      <char>\n1: 2825623524 TAIF:PLANT:318128:1:1:411555 Tracheophyta Polypodiopsida Polypodiales Pteridaceae    Adiantum\n2: 2825649445 TAIF:PLANT:318579:1:1:411579 Tracheophyta Polypodiopsida Polypodiales Pteridaceae Scoliosorus\n                  species infraspecificEpithet taxonRank                         scientificName\n                   <char>               <char>    <char>                                 <char>\n1:      Adiantum andicola                        SPECIES               Adiantum andicola Liebm.\n2: Scoliosorus ensiformis                        SPECIES Scoliosorus ensiformis (Hook.) T.Moore\n                    verbatimScientificName verbatimScientificNameAuthorship countryCode     stateProvince\n                                    <char>                           <lgcl>      <char>            <char>\n1:                Adiantum andicola Liebm.                               NA          MX Oaxaca (瓦哈卡州)\n2: Scoliosorus ensiformis (Hook.) T. Moore                               NA          MX Oaxaca (瓦哈卡州)\n   decimalLatitude decimalLongitude coordinateUncertaintyInMeters elevation   day month  year      basisOfRecord\n             <num>            <num>                        <lgcl>     <int> <int> <int> <int>             <char>\n1:        17.30213         -96.3808                            NA      2267    27     2  2012 PRESERVED_SPECIMEN\n2:        17.30213         -96.3808                            NA      2267    27     2  2012 PRESERVED_SPECIMEN\n```\n:::\n:::\n\n\n<br>\n\n## Filtrar filas\n\nDe acuerdo con la sintaxis del paquete, el espacio i es el lugar en el que se pueden realizar operaciones sobre las filas como los filtros. Por ejemplo, utilizando la tabla de registros de especies de plantas podríamos estar interesados en solo seleccionar aquellos registros que pertenezcan al género Quercus. \n\n```{.r}\ndata_quercus <- data[genus == \"Quercus\",] \n\ndim(data_quercus)\n```\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n[1] 51985    23\n```\n:::\n:::\n\n\nO podríamos estar interesadas en seleccionar solo los registros más viejos, los que fueron colectados antes de 1950. \n\n```{.r}\ndata_quercus_viejos <- data[genus == \"Quercus\" & year <= 1950,]\n\ndim(data_quercus_viejos)\n```\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2927   23\n```\n:::\n:::\n\n\n\n<br>\n\n## Ordenar filas\n\nOtra función que se puede realizar en el espacio de las filas es ordenarlas. Por ejemplo, podríamos ordenar la tabla de registros del género Quercus por estado en orden alfabético.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Ordenar los datos de la tabla de registros de Quercus por estado en orden alfabetico\n\nordered_data = data_quercus[order(stateProvince)]\n\n# seleccionar la columna de estado como vector y seleccionar los valores únicos\n# mostrar solo los primeros valores\n\nunique(ordered_data$stateProvince) |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"\"                        \"Aguascalientes\"          \"Baja California\"         \"Baja California (norte)\"\n[5] \"Baja California Norte\"   \"Baja California Sur\"    \n```\n:::\n:::\n\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio\n\n1. Carga el archivo de registros de plantas utilizando la función fread que revisamos en el tema anterior\n2. Utiliza un filtro para quedarte con las filas que pertenezcan a un género o especie que te guste\n3. Ordena de manera descendente por año\n\nPregunta:\n\n¿De qué año son los registros más nuevos y más viejos de la especie que escogiste? (selecciona utilizando rangos la primera y la última fila de la tabla)\n::: \n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n\n```{.r}\nlibrary(data.table)\n\ndata = fread(\"data/plantae_mexico_conCoords_specimen.csv\", quote=\"\")\n\ndata_quercus <- data[genus == \"Quercus\" & !is.na(year),] \n\ndata_quercus_ordenado <- data_quercus[order(-year)] \n\n# Una función útil en el paquete es la función .N que te permite guardar el número de observaciones en el grupo actual. En este caso solo tenemos un solo grupo y por lo tanto guarda el número de filas en la tabla.\n\ndata_quercus_ordenado[c(1,.N),] |> knitr::kable()\n\n```\n\n\n::: {.cell}\n::: {.cell-output-display}\n|     gbifID|occurrenceID                                        |phylum       |class         |order   |family   |genus   |species               |infraspecificEpithet |taxonRank |scientificName                |verbatimScientificName |verbatimScientificNameAuthorship |countryCode |stateProvince | decimalLatitude| decimalLongitude| coordinateUncertaintyInMeters| elevation| day| month| year|basisOfRecord      |\n|----------:|:---------------------------------------------------|:------------|:-------------|:-------|:--------|:-------|:---------------------|:--------------------|:---------|:-----------------------------|:----------------------|:--------------------------------|:-----------|:-------------|---------------:|----------------:|-----------------------------:|---------:|---:|-----:|----:|:------------------|\n| 4531629317|101427a9-2277-4bbb-b31b-1f7e463b2e0e                |Tracheophyta |Magnoliopsida |Fagales |Fagaceae |Quercus |Quercus hypoleucoides |                     |SPECIES   |Quercus hypoleucoides A.Camus |Quercus hypoleucoides  |A. Camus                         |MX          |Sonora        |        30.82500|       -110.22300|                            NA|      1713|  12|     9| 2023|PRESERVED_SPECIMEN |\n|  730972925|http://coldb.mnhn.fr/catalognumber/mnhn/p/p06859288 |Tracheophyta |Magnoliopsida |Fagales |Fagaceae |Quercus |Quercus caudicans     |                     |SPECIES   |Quercus caudicans Née         |Quercus candicans Née  |Née                              |MX          |Morelos       |        19.02889|        -99.24833|                            NA|        NA|  20|    10| 1827|PRESERVED_SPECIMEN |\n:::\n:::\n\n:::\n\n<br>\n<br>\n\n# Operaciones sobre las columnas\n\n\n::: {.cell}\n\n:::\n\n\n## Seleccionar columnas por índice\n\nDe acuerdo con la sintaxis del paquete, el espacio j nos permite realizar operaciones sobre las columnas. Una de esas operaciones es la selección de columnas. \n\nSe pueden seleccionar por medio de índices:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata[,7:8,]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               genus               species\n              <char>                <char>\n     1:    Syngonium  Syngonium angustatum\n     2:     Scaevola     Scaevola plumieri\n     3:   Tillandsia    Tillandsia fuchsii\n     4:    Commelina     Commelina rufipes\n     5: Heterosperma Heterosperma pinnatum\n    ---                                   \n 99996:   Polypodium                      \n 99997: Hesperoyucca Hesperoyucca whipplei\n 99998: Fimbristylis   Fimbristylis cymosa\n 99999:    Commelina    Commelina tuberosa\n100000:       Salvia    Salvia polystachia\n```\n:::\n:::\n\n\n\n## Seleccionar columnas por nombre\n\n::: {.cell}\n\n:::\n\n\nSe pueden seleccionar las columas por nombre y regresar como vector:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata[,species] |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Syngonium angustatum\"  \"Scaevola plumieri\"     \"Tillandsia fuchsii\"    \"Commelina rufipes\"    \n[5] \"Heterosperma pinnatum\" \"Begonia crassicaulis\" \n```\n:::\n:::\n\n\nSe pueden seleccionar las columnas usando una lista y regresar como tabla:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata[,list(family,genus,species)]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               family        genus               species\n               <char>       <char>                <char>\n     1:       Araceae    Syngonium  Syngonium angustatum\n     2:  Goodeniaceae     Scaevola     Scaevola plumieri\n     3:  Bromeliaceae   Tillandsia    Tillandsia fuchsii\n     4: Commelinaceae    Commelina     Commelina rufipes\n     5:    Asteraceae Heterosperma Heterosperma pinnatum\n    ---                                                 \n 99996: Polypodiaceae   Polypodium                      \n 99997:  Asparagaceae Hesperoyucca Hesperoyucca whipplei\n 99998:    Cyperaceae Fimbristylis   Fimbristylis cymosa\n 99999: Commelinaceae    Commelina    Commelina tuberosa\n100000:     Lamiaceae       Salvia    Salvia polystachia\n```\n:::\n:::\n\n\nUn atajo para no escribir `list()` es `.()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata[,.(family,genus,species)]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               family        genus               species\n               <char>       <char>                <char>\n     1:       Araceae    Syngonium  Syngonium angustatum\n     2:  Goodeniaceae     Scaevola     Scaevola plumieri\n     3:  Bromeliaceae   Tillandsia    Tillandsia fuchsii\n     4: Commelinaceae    Commelina     Commelina rufipes\n     5:    Asteraceae Heterosperma Heterosperma pinnatum\n    ---                                                 \n 99996: Polypodiaceae   Polypodium                      \n 99997:  Asparagaceae Hesperoyucca Hesperoyucca whipplei\n 99998:    Cyperaceae Fimbristylis   Fimbristylis cymosa\n 99999: Commelinaceae    Commelina    Commelina tuberosa\n100000:     Lamiaceae       Salvia    Salvia polystachia\n```\n:::\n:::\n\n\nPara seleccionar columnas guardadas en una variable se puede utilizar el prefijo `..`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvariables <- c(\"family\",\"genus\",\"species\")\n\ndata[ , ..variables]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               family        genus               species\n               <char>       <char>                <char>\n     1:       Araceae    Syngonium  Syngonium angustatum\n     2:  Goodeniaceae     Scaevola     Scaevola plumieri\n     3:  Bromeliaceae   Tillandsia    Tillandsia fuchsii\n     4: Commelinaceae    Commelina     Commelina rufipes\n     5:    Asteraceae Heterosperma Heterosperma pinnatum\n    ---                                                 \n 99996: Polypodiaceae   Polypodium                      \n 99997:  Asparagaceae Hesperoyucca Hesperoyucca whipplei\n 99998:    Cyperaceae Fimbristylis   Fimbristylis cymosa\n 99999: Commelinaceae    Commelina    Commelina tuberosa\n100000:     Lamiaceae       Salvia    Salvia polystachia\n```\n:::\n:::\n\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio\n\n1. Selecciona las columnas que contengan información acerca de la ubicación geográfica de los registros.\n:::\n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n\ninfo_geografica <- c(\"countryCode\", \"stateProvince\", \"decimalLatitude\", \"decimalLongitude\", \"coordinateUncertaintyInMeters\", \"elevation\")\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvars_info_geografica <- c(\"countryCode\", \"stateProvince\", \"decimalLatitude\", \"decimalLongitude\", \"coordinateUncertaintyInMeters\", \"elevation\")\n\ndata[,..vars_info_geografica,]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        countryCode                   stateProvince decimalLatitude decimalLongitude coordinateUncertaintyInMeters\n             <char>                          <char>           <num>            <num>                         <num>\n     1:          MX                        Veracruz        19.33330        -96.66670                            NA\n     2:          MX                         Yucatan        21.25417        -89.80833                            70\n     3:          MX                         Chiapas        15.65000        -92.80000                           100\n     4:          MX                         Chiapas        16.08111        -93.47805                           100\n     5:          MX                         Durango        25.54389       -104.59100                            50\n    ---                                                                                                           \n 99996:          MX                          Mexico        20.00583       -100.13200                            80\n 99997:          MX                 Baja California        32.35806       -116.93146                         10000\n 99998:          MX Veracruz de ignacio de la llave        20.20833        -96.79167                            80\n 99999:          MX             Michoacan de ocampo        19.76222       -100.86611                            80\n100000:          MX                        Guerrero        17.46814       -100.13643                         10490\n        elevation\n            <num>\n     1:        NA\n     2:       0.0\n     3:    1400.0\n     4:     473.5\n     5:    1900.0\n    ---          \n 99996:    2400.0\n 99997:        NA\n 99998:        NA\n 99999:    1020.0\n100000:    1300.0\n```\n:::\n:::\n\n\n:::\n\n## Renombrar columnas\n\nEn el espacio de operaciones sobre las columnas también se pueden renombrar las columnas. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata[, .(especie = species, genero = genus)]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                      especie       genero\n                       <char>       <char>\n     1:  Syngonium angustatum    Syngonium\n     2:     Scaevola plumieri     Scaevola\n     3:    Tillandsia fuchsii   Tillandsia\n     4:     Commelina rufipes    Commelina\n     5: Heterosperma pinnatum Heterosperma\n    ---                                   \n 99996:                         Polypodium\n 99997: Hesperoyucca whipplei Hesperoyucca\n 99998:   Fimbristylis cymosa Fimbristylis\n 99999:    Commelina tuberosa    Commelina\n100000:    Salvia polystachia       Salvia\n```\n:::\n:::\n",
    "supporting": [
      "tema3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}